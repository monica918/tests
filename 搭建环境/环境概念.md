## 环境分类
- 本地环境：通常开发人员会在本地环境中进行代码的开发和调试。一旦他们认为代码在本地环境中运行正常，并通过了本地测试，他们会将代码上传到开发环境中进行进一步的集成和测试。
- 开发环境：本地环境是开发人员个人使用的开发和测试环境，而开发环境是团队协作的环境，用于多个开发人员共享和协同开发代码。
- 测试环境：可以跟开发环境/自动化环境/安全环境等共用一个服务器，测试环境可以再划分泳道
- 预发布环境：在平时测试工作中，可能由于运维配置问题、测试环境差异问题、漏测问题、修改范围评估不足问题导致一些缺陷不能被发现，而导致项目频繁出现软件发布后bug不断，需要回滚的问题，这让开发和测试都是头大的狠，这时候预发布测试就很有必要了，不至于让bug出现在用户面前。
- 灰度环境：在进行灰度测试时，只有部分商户或用户会被选择性地升级到新的应用版本，而其他商户或用户仍然继续使用旧版本的应用。这样可以在一部分用户中进行新功能的验证和测试，同时保持其他用户老版本的稳定运行。
通常会采用分离部署的方式，即将灰度商户的应用部署在独立的服务器或环境中，而将生产商户的应用部署在另一个独立的服务器或环境中。这样可以确保灰度商户和生产商户的应用环境相互隔离，避免新版本的应用对生产商户的影响。灰度商户可以享受新版本的功能和改进，同时生产商户可以继续稳定地使用旧版本的应用。
这样可以最大程度地降低对生产环境的风险和影响，同时进行有效的测试和验证。其实就是小范围的生产环境。
- 生产环境
- 压测环境：对服务器性能要求高，就单独部署在一台服务器上；对性能要求不高，简单压几个接口，就可以把它划分为一个泳道，跟其他泳道共享测试环境
- 自动化测试


## 划分环境/一个环境下划分泳道
- 环境是指提供软件开发、测试和部署所需基础设施的实际系统或平台，泳道是指在同一个环境中划分的逻辑隔离区域，用于隔离不同的功能、版本或团队。泳道可以是一组服务器、数据库实例、存储区域或网络子网等。使用泳道可以实现数据隔离、环境隔离和资源隔离。不同的泳道可以具有不同的配置、数据和访问权限，以满足不同功能或版本的需求，并确保不同团队之间的工作相互独立和安全。
- 泳道可以共享环境里相同的硬件资源（服务器等）、测试环境和测试工具，避免资源的重复配置和浪费。这样可以减少成本和维护工作
- 不管环境还是泳道，都是要做到数据隔离的，可以通过连接不同的数据库或者同一个库里不同的表空间来进行数据隔离

## 服务器/环境/泳道
- 开发环境/测试环境/自动化环境等都可以部署在一台服务器上，灰度/预发布/生产都需要单独部署服务器
- 测试环境可以划分多个泳道，功能测试（主泳道/多条次泳道）/自动化测试（跑测试数据，提测后/上线前跑）等
- 都要做到数据隔离


## 泳道（快速创建工单，进行逻辑隔离）
### 什么是多泳道
多泳道，顾名思义，就是像游泳一样，有多个游泳道，他们互相不影响。 测试环境多泳道，其实是有一个主泳道，多条次泳道，主泳道是作为稳定的泳道，它可以访问其他泳道的服务，其他泳道是不稳定的，这样的话，可以保证测试环境的稳定性。
### 多泳道的目标
- 一方面是保证测试环境稳定，提高测试效率。联想到测试环境，大多数反应是测试环境不稳定，主要由以下原因造成，第一，测试环境部署的是开发中代码，代码的不稳定；第二，测试环境存在脏数据；第三，是对测试环境的不重视，缺少监控等；第四，测试的机器资源没法和线上对齐等因素，导致测试环境必然是不稳定的。因此多泳道方案提出了主泳道和分支泳道概念，主泳道则部署稳定代码和线上代码保持一致，保证了代码的稳定性，然后开发人员只用专心维护一套全链路环境，降低了维护成本，提高了主泳道的稳定性。
- 另一方面解决抢占问题，提高开发效率。在多业务线多需求同时开发时，都需要各自一套环境隔离，相互不造成影响，但测试环境的机器是有限，就会造成大家相互抢占，或者共用同一环境，造成测试效率降低。因此多泳道方案提出一种规范，收回开发人员部署主泳道权限，由系统定期自动部署最新稳定代码，而开发人员只在分支泳道部署变动服务，其余全部依赖主泳道中服务，减少部署量和资源浪费，由于分支泳道非常轻量，可以非常快捷创建和销毁。
### 多泳道的价值收益
经过多业务小组验证，在测试环境创建时间方面至少提升 10 倍，原来创建一套测试环境需要拷贝底层数据库，拉取全链路所有服务等，耗时大概 3 小时，但是泳道方案拉起一个分支泳道只需几分钟。由于分支泳道的快捷性，可以创建更多的分支泳道给不同业务组或者同业务组不同需求。总结一下，就是更快更多更稳定。
工单可以实现不同泳道的快速创建，比如说有个需求A，同一时间有个需求B，可以通过工单快速将dev1、dev2 开放平台两个版本跑起来 (稳定泳道：权限，经常变动泳道：开放平台..)
### 逻辑结构主要分为主泳道和分支泳道。
- 主泳道部署全链路稳定代码，作为公共环境，承载其他环境缺省服务，保证请求链路通畅。
- 分支泳道只需部署改动服务，未改动服务使用主泳道中服务，比如底层的商品，库存等服务，发号器，推送等组件，目的是减少公共服务的维护成本，提高使用效率等。
### 多泳道解决什么问题
- 在测试阶段，我们经常会听到测试同学经常抱怨，测试进度被某个流程卡住，某某背锅开发同学在排查。有时会导致多个测试任务卡住，影响整个流程正常运作，所以我们需要保证测试环境的稳定性。测试环境作为稳定泳道来运作，这样就不会由于开发代码一直卡流程。
- 其次在同一时间，有多个需求同时进行，那么如果A同学改了一个代码，导致test环境炸了，是不是我们也需要等卑微的小A同学修完bug才能继续。多泳道可以解决抢占问题，提高开发效率，就是测试同学通过自己的泳道访问那条修改的代码。而其他同学访问稳定的test环境。
### 测试流程
- 现在需求A、需求B来了，我们拉了两个分支，现在并行提测了
- 创建工单，新建dev1、dev2环境，它会生成对应的域名（dev1.com,dev2.com）指向test网关，然后我们通过全链路灰度，实现test网关通过域名维度，指向对应的服务。注意！：需要对中间件进行改造，比如说dev1、dev2 redis、mq、数据库都需要隔离。
- 测试同事通过不同域名，来验证不同的逻辑，然后去不同的数据库验证数据准确性。
- 测试通过之后，将分支合并到test，构建test环境
- 泳道删除，资源回收。


