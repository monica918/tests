## 项目介绍
- 业务层面（业务中台）   
  - 前台
  - 业务中台的价值，是能将业务中台化（聚合复用率高的业务模块），复用到新项目上，避免重复建设项目，节省成本。  
比如电商的业务中台有订单中心/商品中心/用户中心，这样可以快速造好项目：天猫/淘宝/聚划算等（但是他们都有不同的后台管理系统，每一个项目都有自己对应的后台管理系统，里面是不同的订单/商品/用户等的数据）。  
结合到星星充电，业务中台（oms）上有客户/企业/订单/活动/大客户等业务模块，以便快速造好项目：美丽充app/美丽充小程序/星充app/星充小程序/h5商城/私桩小程序等(不同项目都有各自后台)
  - 后台
  
- 系统层面  
项目架构：基于centos的操作系统，使用spring cloud 的微服务架构，分布式集群部署，消息中间件用的是kafka，使用消息发布/订阅模式来进行服务间的通信（charing服务发送"data_stubstatus_info_all_biz"这个topic,evcs服务来消费该topic），数据库用的是关系型数据库MySQL和文档型数据库mongodb，缓存用的jvm本地缓存和redis分布式缓存。
监控系统：cat/Prometheus/Grafana   cat，美洲云全量回归的时候查询生产上的接口调用频率，这样可以确定哪些接口不怎么使用了
代码质量和安全扫描和分析平台：SonarQube
接口自动化平台：MeterSphere
查看日志：阿里云（日志库）/Rancher（是一个Kubernetes管理工具，让你能在任何地方和任何提供商上部署和运行集群，我用来查看日志(pods模块)）
测试环境部署：ark方舟服务器（主要部署公有云）/jenkins（部署主机厂定制化的服务）
gitlab：查看变动代码行数

- 产品线  
2B：saas充电运营系统/oms星充商家管理系统/omc运维中心   2C：充电小程序/充电app/h5  2P：标准化互联互通/定制化互联互通/政府上报
补充2P模式：
对于商家来说，他们是通过注册成为亚马逊的第三方卖家，将自己的商品放置在亚马逊平台上进行销售。亚马逊作为平台提供了销售渠道、支付处理、物流服务等基础设施，连接了商家和消费者。这是一个 "To Platform"（2P）的模式。
因此，同一个平台可以在不同方向上服务不同的参与者，对于消费者是 "2C" 模式，而对于商家是 "2P" 模式。


## 服务串联场景   
用户使用app(调usercenter服务)，app查询场站(如果涉及到互联互通，第三方平台来查询我们的桩，通过evcs_msp--》evcs--》baseinfo)，进行充值/预支付(调金融网关服务)，进行充电(如果涉及到互联互通，第三方平台来启动我们的桩，通过evcs_msp--》evcs--》charging)，电费搞活动(调sale服务)充完时停车服务(调parking服务)，结束充电，后续一系列支付服务/开票活动/评论服务等


## 服务分级
L0	核心服务	不可降级，一旦异常，主业务流程异常（充电服务-Charging/充电基础信息服务-Baseinfo/互联互通-Evcs）    
L1	关键服务	影响分支流程，一旦异常，影响部分主业务流程 （停车服务-Parking/互联互通推送服务-evcs-push（从互联互通剥离出来负责状态类通知业务（桩群状态、桩状态通知、充电过程状态通知））/主机厂定制化msp（福特、宝马等独立部署的evcs-msp服务）
L2	一般服务	一旦异常，不影响主业务流程，用户有感  政府上报-dxp（政府上报的本质是享受政策红利，通过上报充电订单、充电过程数据、设备变化数据来证明企业的充电电量，政府平台根据充电电量给予补贴）
L3	外围服务	一旦异常，对用户无感


## 互联互通
- evcs标准版互联互通：星星充电平台与客户运营方平台基于T/CEC102规范进行对接与通讯。补充：标准版分为2种 1。中电联(T/CEC)协议又称互联互通(EVCS)标准协议（2016版）（行业标准的规范）2。互联互通星充扩展版协议（starcharge版）（星充在行业规范上发展出的自己平台的规范）
- evcs_msp通用定制化互联互通：除T/CEC102规定的标准功能外，星星充电可在原规范基础上进行扩展，可支持以下功能：充电预支付到星星充电/星星充电开票/预约充电/地锁控制/充电后支付到星星充电/充电卡券/即插即充/道闸对接等，可对接多个三方平台
- evcs_bmw/evcs_vw主机厂定制化互联互通：针对宝马/奔驰/福特/一汽大众之类的主机厂，定制的功能，一对一的，不适合其他三方平台使用


接口：查询类/推送类，涉及场景：设备信息/充电流程
星充平台和第三方平台的通信，星星充电平台与其他平台建立充电服务交换关系：让星充可以使用第三方的充电桩，第三方可以使用星充的充电桩
第三方平台：客户运营商，开发了自己的网站/app等平台，从自己的平台去拉取星充运营桩群的数据/启动星充运营桩群的充电流程。比如顺丰开发了自己的app（小风app），南京公交开发了自己的数据监控平台
星充平台：设备运营商（第三方购买星充的桩之后，托管给星充平台来进行桩群运营）设备归属商（星充自己的桩，自营的，用户可以从别的充电app进入（比如高德），查找星充的桩进行充电）
第三方请求星充流程（定制化）四件套： 第三方平台(对方evcs--》对方evcs-msp)---evcs_msp---evcs---星充平台（调用内部parking/baseinfo/reserve/charging等服务）
第三方请求星充流程（标准化）： 第三方平台(对方evcs)---evcs---星充平台（调用内部parking/baseinfo/reserve/charging等服务）
evcs_msp的底层是evcs，是evcs套了层东西（msp接口在evcs接口的基础上进行字段修改，定制化接口），所以查询请求的时候evcs_msp肯定会调用到evcs，查日志的话，msp有日志，evcs肯定也有，evcs有日志，msp不一定有（没套东西）。



## bug排查
1。查看接口返回数据，判断请求是否成功
2。查看数据库（上下游的库）
3。查看日志（上下游日志）
4。关键字检索日志：接口名/topic/订单号/桩号等，自己能排查的，截图检索的关键字/traceid/上下文日志发送给开发，无法自己排查的，就发送检索的关键字/订单号/桩号等给开发
5。关键字检索不到日志的，先请求接口触发日志，再根据时间倒序，查询最近的一条日志，提交给开发





## 运营模式
- 自建桩，自己运营
- 自建桩，别的运营商来运营
- 代运营别家的桩
- 各个运营商都聚合到第三方平台，进行引流

自建桩，别的运营商来运营/代运营别家的桩，这两个实现互联互通(场站查询、导航、充电到支付环节的全面互联互通)
各个运营商都聚合到第三方平台进行引流，这种方式不一定实现互联互通（需要运营商自己再互相签订互联互通的协议），只是实现引流，各个运营商增加桩的曝光量，运营还是自己运营，第三方平台只是提供平台进行桩曝光



EVCS核心链路
query_token 获取token 
query_equip_auth 设备认证 
query_start_charge  启动充电 
query_equip_charge_status  查询充电中状态 
query_stop_charge  请求停止充电 
query_charge_info 查询订单详情 
notification_charge_order_info 推送充电订单信息
check_charge_orders 推送订单对账结果 








