熔断和限流是一种在分布式系统中用于提高系统稳定性和防止雪崩效应的策略。

熔断（Circuit Breaking）：
概念： 熔断是一种保护机制，用于在系统出现异常或故障时快速中断请求，以防止问题进一步扩大。当系统组件发生故障或超出预定的阈值时，熔断器会中断对该组件的请求，而不是持续地尝试执行可能导致更严重问题的操作。
例子： 考虑一个微服务架构的系统，其中服务A依赖于服务B。如果服务B发生故障，服务A的熔断器可以检测到问题，并在一段时间内停止向服务B发出请求，防止故障进一步传播。一旦服务B恢复正常，熔断器可以慢慢地重新允许请求。

限流（Rate Limiting）：
概念： 限流是一种控制系统流量的手段，防止系统因过多请求而不稳定或崩溃。通过设定每个时间单位内可以处理的请求数目，限流确保系统不会超过其处理能力。
例子： 假设有一个Web API，它提供某种服务。为了防止过多的请求导致服务器超载，可以实施限流。例如，限制每秒钟允许的请求次数为100次。一旦达到限制，服务器可以拒绝额外的请求或者返回一个适当的错误码，而不是无法响应或崩溃。

综合熔断和限流，可以有效地保护系统免受过多负载、故障或异常情况的影响，提高系统的可用性和稳定性。

指标概念：
QPS（Queries Per Second）是衡量一个系统在单位时间内处理请求数量的一个指标。
RT（Response Time）是指系统对请求做出响应的时间，即从请求发出到接收到系统返回的响应之间的时间间隔。


Sentinel事件触发涉及到分布式系统中的熔断机制，用于监控和保护系统的稳定性和可用性。这里是一个典型的事件触发流程示例，特别是针对flow/1/default/cec_request的触发情况：
1。监控规则设置:
在规则中指定资源名称，例如 cec_request，设定流量控制规则：例如QPS限制、阈值、限流效果(快速失败/排队等待等)。

2。事件监控及处理:
Sentinel(流量控制组件)会实时监控资源 cec_request 的流量，调用接口，当流量超过设定的阈值时，触发熔断或限流逻辑(例如拒绝请求、返回默认响应等)。
ps：测试的时候，想要触发熔断限流，可以设置阈值为0，这时候只要调用接口，qps>0,就会触发熔断限流


3。事件通知:
事件触发后，Sentinel可以将信息记录到日志中，或者通过其他方式通知相关系统或运维人员。

4。恢复策略:
Sentinel会根据规则和恢复策略，在流量恢复正常后自动解除限流或熔断。



流控规则的主要目的是通过控制流量的访问速率或并发度来保护系统，避免系统因瞬时高并发或高流量导致过载。
主要配置项和触发条件
资源名（Resource Name）：需要进行流量控制的资源。
阈值类型（Threshold Type）：
QPS（Queries Per Second）：每秒允许的最大请求数。
并发线程数（Concurrent Threads）：允许的最大并发线程数。
流控模式（Control Behavior）：
直接拒绝（Direct Rejection）：超过阈值的请求直接拒绝。
预热（Warm Up）：系统逐渐提升请求阈值，适用于系统启动时预热阶段。
排队等待（Queueing）：超过阈值的请求进入队列，等待处理。
作用和应用场景
流控规则适用于需要对系统进行实时流量控制的场景，防止突发流量导致系统崩溃。例如：
限制对数据库的高频访问。
控制对下游微服务的请求频率。
保护接口免受流量突增的影响。



降级规则的主要目的是在系统检测到资源运行异常（如高RT、高异常比率或高异常数）时，临时降低资源的服务质量或停止对资源的访问，以保护系统整体稳定性。
示例：调用710930720所有接口，10次请求有8次请求超过2秒 触发降级；降级时间 30秒
主要配置项和触发条件
资源名（Resource Name）：需要进行降级保护的资源。
降级策略（Degrade Strategy）：
响应时间（RT, Response Time）：如果一段时间内，资源的平均响应时间超过阈值，且触发比例阈值，则对该资源进行降级。
异常比率（Exception Ratio）：如果一段时间内，资源的请求异常比率（异常数 / 总请求数）超过阈值，则对该资源进行降级。
异常数（Exception Count）：如果一段时间内，资源的异常数超过阈值，则对该资源进行降级。
降级时间窗口（Time Window）：降级触发后，资源降级的时间窗口，在这个时间内，资源会被降级处理。
作用和应用场景
降级规则适用于需要在系统出现异常时保护整体服务质量的场景。例如：
当数据库响应时间过长时，对访问数据库的操作进行降级，避免影响整体服务。
当某个微服务的错误率过高时，对该服务的请求进行降级处理，避免影响其他服务。
在大规模故障或流量洪峰时，通过降级保护核心服务。


区别总结
触发条件：
流控规则：基于实时流量控制（QPS或并发线程数）来触发限流。
降级规则：基于系统的运行状态（RT、异常比率、异常数）来触发降级。
目的：
流控规则：防止系统因高并发或高流量导致过载，通过限流来保护系统。
降级规则：在系统出现异常时，通过降级处理来保护整体系统的稳定性和服务质量。
应用场景：

流控规则：适用于需要实时控制请求量的场景，如API网关、数据库连接池等。
降级规则：适用于需要在异常情况下保护系统的场景，如服务熔断、故障隔离等。

